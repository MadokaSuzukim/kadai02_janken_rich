<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>価値観合う合わない！？ゲーム</title>
    <link rel="stylesheet" href="style.css">
    <!-- <link rel="icon" href="path/to/favicon.ico" type="image/x-icon"> -->
</head>
<body>
    <div align="center">
        <h2>価値観合う合わない！？ゲーム</h2>
        「スタート」を押した後に、<br>今の心の調子を「😁」「😀」「😂」３つのスタンプから選んでね。<br>
        <br>相手の感情は読めません。あなたの今の状態を教えてください。<br>
        <br>

        <!-- スタートボタンに音声再生機能を組み合わせる -->
        <button onclick="startWithSound();">スタート（音付き）</button>
        <!-- <div class="btn" onclick="startWithSound();">スタート</div> -->
        
        <!-- mute切り替えボタン -->
        <div class="mute_btn" onclick="mute()">muteの切り替え</div>

        <!-- 音声ファイル -->
        <audio id="btn_audio">
        <source src="start.mp3" type="audio/mp3">
        </audio>

        <!-- <button id="startButton" onclick="start();">スタート</button>  -->
        <button id="smailButton" onclick="janken('😁');" disabled>😁</button>
        <button id="nomalButton" onclick="janken('😀');" disabled>😀</button>
        <button id="cryButton" onclick="janken('😂');" disabled>😂</button>
        <br>
        <table border="1" style="border-collapse: collapse">
            <tr>
                <td align="center"><h2>貴方の感情 <div id="PlayerHand"> </div></h2></td>
                <td align="center"><h2>相手の感情 <div id="RivalHand"> </div></h2></td>
            </tr>
            <br>何を選んでも、正解不正解はありません
        </table>
        <br>
        <div id="Result"></div>
    </div>

    <!-- モーダルのHTML -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalText"></p>
            <button id="retryButton">再トライ</button>

            <!-- 終了する際に再生する音声ファイル -->
<audio id="close_audio">
    <source src="next.mp3" type="audio/mp3">
</audio>

<!-- 終了するボタンに音声再生機能を組み合わせる -->
<button onclick="closeWithSound();">終了する</button>

            <a href="https://marumark-98145.bubbleapps.io/signin" target="_blank" class="marumark-button">Marumark</a>
            
    </div>
        </div>
    </div>
    <button id="yourButtonId">クリック</button>
    <script>
        const FPS = 30;
        const HANDS = ['😁', '😀', '😂'];
        let lastRivalHandIndex = 0;
        let gameLoopInterbalId = null;

        function gameLoop() {
            const handIndex = (lastRivalHandIndex + 1) % HANDS.length;
            lastRivalHandIndex = handIndex;
            document.getElementById("RivalHand").innerHTML = HANDS[handIndex];
        }

        function start() {
            // ここにゲームのスタートに関する処理を記述 */
            console.log("ゲームをスタートします。");
            // スタートボタンを無効化する
            // document.getElementById("startButton").disabled = true;

            // 他のボタンを有効化する
            document.getElementById("smailButton").disabled = false;
            document.getElementById("nomalButton").disabled = false;
            document.getElementById("cryButton").disabled = false;

            // プレイヤーと相手の手を初期化する
            document.getElementById("PlayerHand").innerHTML = ' ';
            document.getElementById("RivalHand").innerHTML = '';

            // 結果表示をクリアする
            document.getElementById("Result").innerHTML = '';
            gameLoopInterbalId = setInterval(gameLoop, 1000 / FPS);
        
            // ゲームループを開始する
            // if (gameLoopInterbalId !== null) 
            clearInterval(gameLoopInterbalId); // 以前のゲームループが存在する場合はクリアする
            gameLoopInterbalId = setInterval(gameLoop, 1000 / FPS);
           }

            // startWithSound() 関数は正しく音声を再生してから start() 関数を呼び出しているので、このロジックはそのままで問題ありません。
            function startWithSound() {
            audio(); // 音声を再生する関数を呼び出す
            start(); // ゲームのスタート処理を呼び出す
           }

            function audio() {
            var sound = document.getElementById("btn_audio"); // audio要素を取得
            sound.play(); // 音声を再生
            }

    function closeWithSound() {
    var sound = document.getElementById("close_audio"); // close_audio要素を取得
    sound.play(); // 音声を再生

    
}

   

    
    // モーダルを閉じる処理もここに追加するか、もしくはモーダルを閉じる別の処理をトリガーする
    var modal = document.getElementById('resultModal');
    modal.style.display = 'none';

    // モーダル内の再トライボタンを取得
    var retryButton = document.getElementById('retryButton');
    
    // 再トライボタンにクリックイベントハンドラを設定
    retryButton.addEventListener('click', function() {
        var modal = document.getElementById('resultModal');
        modal.style.display = 'none'; // モーダルを非表示にする
        start(); // ゲームを再スタート

    
     // 再トライボタンのクリックイベント
     retryButton.onclick = function() {
    modal.style.display = 'none'; // モーダルを閉じる
    start(); // ゲームを再スタート
    }});
    document.addEventListener("DOMContentLoaded", function() {
      
    });

    function janken() {
  var smileButton = document.getElementById("smileButton");
  if (smileButton !== null) {
    smileButton.disabled = true; // ここでエラーが発生している
  } else {
    console.log("smileButton not found");
  }
  var normalButton = document.getElementById("normalButton"); // 正しいIDを指定
  if (normalButton !== null) {
    normalButton.disabled = true; // normalButtonが存在する場合にdisabledをtrueに設定
  } else {
    console.log("normalButton not found"); // normalButtonが見つからない場合のログ
  }

  var cryButton = document.getElementById("cryButton"); // 正しいIDを指定
  if (cryButton !== null) {
    cryButton.disabled = true; // cryButtonが存在する場合にdisabledをtrueに設定
  } else {
    console.log("cryButton not found"); // cryButtonが見つからない場合のログ
  }

  // 以下、ゲームのロジック
}


// function janken() {
//   var button = document.getElementById("yourButtonId"); // 正しいIDに置き換えてください
//   if (button !== null) { // 要素が存在するか確認
//     button.disabled = true;
//   } else {
//     console.log("Button element not found!"); // 要素が見つからない場合のエラーメッセージ
//   }
// }
//     function janken() {
//     var button = document.getElementById("buttonId"); // 正しいIDを使用
//     if (button) { // buttonがnullでないことを確認
//     button.disabled = true;
//   }
// }
    document.addEventListener('DOMContentLoaded', function () {
    var closeButton = document.getElementsByClassName('close-button')[0]; // クラス名が 'close-button' の要素を取得
    var modal = document.getElementById('resultModal'); // モーダルの要素を取得
    closeButton.addEventListener('click', function() {
    modal.style.display = 'none'; // モーダルを非表示にする
    });
});
// モーダルウィンドウの要素を取得
var modal = document.getElementById('myModal');
          window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
          }
        function janken(playerHand) {
            clearInterval(gameLoopInterbalId);// 既存のゲームループを停止

            document.getElementById("PlayerHand").innerHTML = playerHand;// プレイヤーの選択を表示

            const rivalHand = HANDS[lastRivalHandIndex];// 相手の手を取得
            let result = "";// 結果を格納する変数

            // 結果の判定ロジック
            if (playerHand === rivalHand) {
                result = "価値観合いますね！でも、今日だけかもしれません。あなたにとって、そして相手にとっての価値観を認識していけたら良いですね!良かったらMARUMARKをタップして、日々の心の調子をチェックしてみませんか？";
            } else if (playerHand === '😁' && rivalHand === '😀') {
                result = "何かしら、不一致がある部分があるのかもしれません、対話で擦り合わせてみませんか？良かったらMARUMARKをタップして、日々の心の調子をチェックしてみませんか？";
            } else if (playerHand === '😂' && rivalHand === '😁') {
                result = "あなたの感情を開示できる状態じゃないのかもしれない。しんどさがあったら誰かに打ち明けるのも一つです。良かったらMARUMARKをタップして、日々の心の調子をチェックしてみませんか？";
            } else if (playerHand === '😂' && rivalHand === '😀') {
                result = "価値観に誤解はつきものです。いつでも完全に理解はできないということを頭に入れて、自分自身の想いを共有してみましょう。良かったらMARUMARKをタップして、日々の心の調子をチェックしてみませんか？";
            } else if (playerHand === '😁' && rivalHand === '😂' || playerHand === '😀' && rivalHand === '😂') {
                result = "自分にとって良い状況は、もしかしたら相手にとっては不快なのかもしれないと考えてみても良いですね。良かったらMARUMARKをタップして、日々の心の調子をチェックしてみませんか？";
            } else if (playerHand === '😀' && rivalHand === '😁' ) {
                result = "自分にとっての状況は、もしかしたら相手にはよい印象を与えているかもしれないと考えてみても良いですね。良かったらMARUMARKをタップして、日々の心の調子をチェックしてみませんか？";
            }else {
                result = "皆違って当たり前ですよね!良かったらもう一度試してみましょう。良かったらMARUMARKをタップして、日々の心の調子をチェックしてみませんか？";
            }

            showModal(result); // 結果をモーダルで表示

            // ボタンの状態をリセット
            document.getElementById("startButton").disabled = false;
            document.getElementById("smailButton").disabled = true;
            document.getElementById("nomalButton").disabled = true;
            document.getElementById("cryButton").disabled = true;

            function showModal(result) {
                var modal = document.getElementById('resultModal');
            var modalText = document.getElementById('modalText');
            modalText.innerText = result; // innerHTMLではなくinnerTextを使用しても良い
            modal.style.display = 'block';
            }
            // var modal = document.getElementById('resultModal');
            // var modalText = document.getElementById('modalText');
            // modalText.innerHTML = result;
            // modal.style.display = 'block';

            var closeButton = document.getElementsByClassName('close-button')[0];
            closeButton.onclick = function() {
                modal.style.display = 'none';
            }
           }

        function mute() {
    if (document.getElementById('btn_audio').muted) {
        document.getElementById('btn_audio').muted = false;
    } else {
        document.getElementById('btn_audio').muted = true;
    }
}
        //    // muteの切り替え
        //     function mute() {
        //     var sound = document.getElementById("btn_audio");
        //     sound.muted = !sound.muted; // ミュート状態を切り替える
// }

    </script>
</body>
</html>

