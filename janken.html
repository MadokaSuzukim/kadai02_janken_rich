<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>価値観合う合わない！？ゲーム</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div align="center">
        <!-- ゲームのタイトル -->
        <h2>価値観合う合わない！？ゲーム</h2>
        <!-- ゲームの説明 -->
        「スタート」を押した後に、
        <br>今の心の調子を「😁」「😀」「😂」３つのスタンプから選んでね。<br>
        <br>相手の感情は読めません。あなたの今の状態を教えてください。<br>
        <br>
        <!-- スタートボタン -->
        <button id="startButton" onclick="start();">スタート</button>
        <!-- スマイルボタン（無効状態から開始） -->
        <button id="smailButton" onclick="janken('😁');" disabled>😁</button>
        <!-- ノーマルボタン（無効状態から開始） -->
        <button id="nomalButton" onclick="janken('😀');" disabled>😀</button>
        <!-- 泣き顔ボタン（無効状態から開始） -->
        <button id="butButton" onclick="janken('😂');" disabled>😂</button>
        <br>
        <!-- ゲーム結果を表示するテーブル -->
        <table border="1" style="border-collapse: collapse">
            <tr>
                <!-- プレイヤーの選択した感情 -->
                <td align="center"><h2>貴方の感情 <div id="PlayerHand"> </div></h2></td>
                <!-- 相手の感情 -->
                <td align="center"><h2>相手の感情 <div id="RivalHand"> </div></h2></td>
            </tr>
            <br>何を選んでも、正解不正解はありません
        </table>
        <br>
        <!-- ゲームの結果表示 -->
        <div id="Result"></div>
    </div>

    <!-- モーダルのHTML構造 -->
    <!-- モーダルウィンドウとは、Webサイトやアプリの最前面に表示され、要求される操作を行わない限り消えない要素のこと -->
    <div id="resultModal" class="modal">
        <div class="modal-content">
            <!-- モーダルを閉じるボタン -->
            <span class="close-button">&times;</span>
            <!-- モーダルのテキスト -->
            <p id="modalText"></p>
            <!-- 再トライボタン -->
            <button id="retryButton">再トライ</button>
            <!-- 外部リンク -->
            <a href="https://marumark-98145.bubbleapps.io/signin" target="_blank" class="marumark-button">Marumark</a>
        </div>
    </div>

    <script>
        // 定数と変数の定義
        // 相手の絵文字が変わり続ける動き
        // Unicode
        const FPS = 30; // フレームレート
        const HANDS = ['😁', '😀', '😂']; // 手の選択肢
        let lastRivalHandIndex = 0; // 相手の最後の手のインデックス
        let gameLoopInterbalId = null; // ゲームループのID

        // ゲームループ関数
        function gameLoop() {
            const handIndex = (lastRivalHandIndex + 1) % HANDS.length;
            lastRivalHandIndex = handIndex;
            document.getElementById("RivalHand").innerHTML = HANDS[handIndex];
        }

        // ゲームを開始する関数
        function start() {
            document.getElementById("startButton").disabled = true;
            document.getElementById("smailButton").disabled = false;
            document.getElementById("nomalButton").disabled = false;
            document.getElementById("butButton").disabled = false;
            document.getElementById("PlayerHand").innerHTML = ' ';
            document.getElementById("Result").innerHTML = '';
            gameLoopInterbalId = setInterval(gameLoop, 1000 / FPS);
        }

        // モーダルを表示する関数
        function showModal(result) {
            var modal = document.getElementById('resultModal');
            var modalText = document.getElementById('modalText');
            modalText.innerHTML = result;
            modal.style.display = 'block';

            var closeButton = document.getElementsByClassName('close-button')[0];
            closeButton.onclick = function() {
                modal.style.display = 'none';
            }

            // 再トライボタンのクリックイベント
            retryButton.onclick = function() {
                modal.style.display = 'none'; // モーダルを閉じる
                start(); // ゲームを再スタート
            }

            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }
        }

        // じゃんけんを実行する関数
        function janken(playerHand) {
            clearInterval(gameLoopInterbalId);

            document.getElementById("PlayerHand").innerHTML = playerHand;

            const rivalHand = HANDS[lastRivalHandIndex];
            let result = "";

            // 結果の判定ロジック
            // （ここには各条件による結果の判定が記述されています）

            showModal(result); // 結果をモーダルで表示

            // ボタンの状態をリセット
            document.getElementById("startButton").disabled = false;
            document.getElementById("smailButton").disabled = true;
            document.getElementById("nomalButton").disabled = true;
            document.getElementById("butButton").disabled = true;
        }
    </script>
</body>
</html>

